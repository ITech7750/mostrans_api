package root.utils;

import client.UserDataClient;
import org.springframework.web.client.RestTemplate;
import org.telegram.telegrambots.bots.TelegramLongPollingBot;
import org.telegram.telegrambots.meta.api.objects.Update;

import java.util.HashMap;
import java.util.Map;

import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
import root.config.BotConfig;
import root.handler.Handler;
import root.ui.UIRenderer;

public class LoadForecastTelegramBot extends TelegramLongPollingBot {

    private final RestTemplate restTemplate = new RestTemplate(); // Create a RestTemplate instance
    private final UserDataClient userDataClient = new UserDataClient(restTemplate); // Pass the RestTemplate to UserDataClient
    private final Handler handler = new Handler(userDataClient);  // Pass UserDataClient to Handler
    private final UIRenderer uiRenderer = new UIRenderer(userDataClient); // Pass the UserDataClient to UIRenderer
    private final Map<Long, String> userStates = new HashMap<>();  // Для отслеживания состояния пользователя
    public static Map<Long, UserData> userData = new HashMap<>();  // Хранение данных пользователя

    @Override
    public String getBotUsername() {
        return BotConfig.BOT_USERNAME;
    }

    @Override
    public String getBotToken() {
        return BotConfig.BOT_TOKEN;
    }

    @Override
    public void onUpdateReceived(Update update) {
        // Проверка, есть ли сообщение и содержит ли оно текст
        if (update.hasMessage() && update.getMessage().hasText()) {
            String messageText = update.getMessage().getText(); // Текст сообщения
            long chatId = update.getMessage().getChatId(); // ID чата

            if (userStates.containsKey(chatId)) {
                // Если пользователь уже находится в процессе ввода данных, обрабатываем его состояние
                try {
                    handler.handleState(chatId, messageText, this, userStates, userData);
                } catch (TelegramApiException e) {
                    throw new RuntimeException(e);
                }
            } else {
                // Если это новое сообщение от пользователя, начинаем процесс с основного меню
                handler.handleInitialMessage(chatId, messageText, this, userStates, userData);
            }
        }
    }

    // Получаем список станций для каждой линии метро
    public Map<String, String[]> getMetroLines() {
        Map<String, String[]> metroLines = new HashMap<>();

        metroLines.put("Сокольническая линия", new String[]{
                "Библиотека имени Ленина", "Бульвар Рокоссовского", "Воробьевы горы", "Комсомольская",
                "Красносельская", "Красные ворота", "Кропоткинская", "Лубянка", "Новомосковская", "Ольховая",
                "Охотный ряд", "Парк Культуры", "Потапово", "Преображенская площадь", "Прокшино", "Проспект Вернадского",
                "Румянцево", "Саларьево", "Сокольники", "Спортивная", "Тропарёво", "Университет", "Филатов Луг",
                "Фрунзенская", "Черкизовская", "Чистые пруды", "Юго-Западная"
        });

        metroLines.put("Замоскворецкая", new String[]{
                "Автозаводская", "Алма-Атинская", "Аэропорт", "Беломорская", "Белорусская", "Водный стадион",
                "Войковская", "Динамо", "Домодедовская", "Кантемировская", "Каширская", "Коломенская", "Красногвардейская",
                "Маяковская", "Новокузнецкая", "Орехово", "Павелецкая", "Речной вокзал", "Сокол", "Тверская", "Театральная",
                "Технопарк", "Ховрино", "Царицыно"
        });

        metroLines.put("Арбатско-Покровская линия", new String[]{
                "Арбатская", "Бауманская", "Волоколамская", "Измайловская", "Киевская", "Крылатское",
                "Кунцевская", "Курская", "Митино", "Молодежная", "Мякинино", "Парк Победы", "Партизанская",
                "Первомайская", "Площадь Революции", "Пятницкое шоссе", "Семеновская", "Славянский бульвар",
                "Смоленская", "Строгино", "Щелковская", "Электрозаводская"
        });

        metroLines.put("Филевская линия", new String[]{
                "Александровский сад", "Арбатская", "Багратионовская", "Деловой центр", "Киевская",
                "Кунцевская", "Кутузовская", "Москва-Сити", "Пионерская", "Смоленская", "Студенческая",
                "Филевский парк", "Фили"
        });

        metroLines.put("Кольцевая линия", new String[]{
                "Белорусская", "Добрынинская", "Киевская", "Комсомольская", "Краснопресненская",
                "Курская", "Новослободская", "Октябрьская", "Павелецкая", "Парк Культуры",
                "Проспект Мира", "Таганская"
        });

        metroLines.put("Калужско-Рижская линия", new String[]{
                "Академическая", "Алексеевская", "Бабушкинская", "Беляево", "Ботанический сад", "ВДНХ",
                "Калужская", "Китай-город", "Коньково", "Ленинский проспект", "Медведково",
                "Новоясеневская", "Новые Черёмушки", "Октябрьская", "Проспект Мира", "Профсоюзная",
                "Рижская", "Свиблово", "Сухаревская", "Теплый стан", "Третьяковская", "Тургеневская",
                "Шаболовская", "Ясенево"
        });

        metroLines.put("Таганско-Краснопресненская линия", new String[]{
                "Баррикадная", "Беговая", "Волгоградский проспект", "Выхино", "Жулебино", "Китай-город",
                "Котельники", "Кузнецкий мост", "Кузьминки", "Лермонтовский проспект", "Октябрьское поле",
                "Планерная", "Полежаевская", "Пролетарская", "Пушкинская", "Рязанский проспект", "Спартак",
                "Сходненская", "Таганская", "Текстильщики", "Тушинская", "Улица 1905 года", "Щукинская"
        });

        metroLines.put("Калининско-Солнцевская линия", new String[]{
                "Авиамоторная", "Аэропорт Внуково", "Боровское шоссе", "Говорово", "Деловой центр",
                "Ломоносовский проспект", "Марксистская", "Минская", "Мичуринский проспект", "Новогиреево",
                "Новокосино", "Новопеределкино", "Озёрная", "Парк Победы", "Перово", "Площадь Ильича",
                "Пыхтино", "Раменки", "Рассказовка", "Солнцево", "Третьяковская", "Шоссе Энтузиастов"
        });

        metroLines.put("Серпуховско-Тимирязевская линия", new String[]{
                "Алтуфьево", "Аннино", "Бибирево", "Боровицкая", "Бульвар Дмитрия Донского", "Владыкино",
                "Дмитровская", "Менделеевская", "Нагатинская", "Нагорная", "Нахимовский Проспект",
                "Отрадное", "Петровско-Разумовская", "Полянка", "Пражская", "Савеловская", "Севастопольская",
                "Серпуховская", "Тимирязевская", "Тульская", "Улица академика Янгеля", "Цветной бульвар",
                "Чертановская", "Чеховская", "Южная"
        });

        metroLines.put("Люблинско-Дмитровская линия", new String[]{
                "Борисово", "Братиславская", "Бутырская", "Верхние Лихоборы", "Волжская", "Достоевская",
                "Дубровка", "Зябликово", "Кожуховская", "Крестьянская застава", "Лианозово", "Люблино",
                "Марьина роща", "Марьино", "Окружная", "Петровско-Разумовская", "Печатники", "Римская",
                "Селигерская", "Сретенский бульвар", "Трубная", "Физтех", "Фонвизинская", "Чкаловская",
                "Шипиловская", "Яхромская"
        });

        metroLines.put("Большая кольцевая линия", new String[]{
                "Авиамоторная", "Аминьевская", "Варшавская", "Воронцовская", "Давыдково", "Зюзино",
                "Каховская", "Каширская", "Кленовый бульвар", "Кунцевская", "Лефортово", "Марьина Роща",
                "Мичуринский проспект", "Мнёвники", "Нагатинский Затон", "Народное Ополчение",
                "Нижегородская", "Новаторская", "Петровский парк", "Печатники", "Проспект Вернадского",
                "Рижская", "Савеловская", "Сокольники", "Текстильщики", "Терехово", "Хорошёвская",
                "ЦСКА", "Электрозаводская"
        });

        return metroLines;
    }

    // Получаем список станций для каждой линии МЦД
    public Map<String, String[]> getMCDLines() {
        Map<String, String[]> mcdLines = new HashMap<>();

        mcdLines.put("МЦД-1 «Белорусско-Савеловский диаметр»", new String[]{
                "Баковка", "Беговая", "Белорусская", "Бескудниково", "Водники", "Дегунино",
                "Долгопрудная", "Кунцевская", "Лианозово", "Лобня", "Марк", "Немчиновка",
                "Новодачная", "Одинцово", "Окружная", "Рабочий Посёлок", "Савеловская",
                "Сетунь", "Сколково", "Славянский бульвар", "Тестовская", "Тимирязевская",
                "Фили", "Хлебниково", "Шереметьевская"
        });

        mcdLines.put("МЦД-2 «Курско-Рижский диаметр»", new String[]{
                "Аникеевка", "Битца", "Бутово", "Волоколамская", "Гражданская", "Депо",
                "Дмитровская", "Калитники", "Красногорская", "Красный Балтиец", "Красный Строитель",
                "Курская", "Курьяново", "Люблино", "Марьина Роща", "Москва-Товарная",
                "Москворечье", "Нахабино", "Новохохловская", "Опалиха", "Остафьево",
                "Павшино", "Пенягино", "Перерва", "Печатники", "Площадь трёх вокзалов",
                "Подольск", "Покровское", "Рижская", "Силикатная", "Стрешнево", "Текстильщики",
                "Трикотажная", "Тушинская", "Царицыно", "Щербинка", "Щукинская"
        });

        mcdLines.put("МЦД-3 «Ленинградско-Казанский диаметр»", new String[]{
                "Авиамоторная", "Андроновка", "Быково", "Вешняки", "Выхино", "Грачёвская",
                "Есенинская", "Зеленоград-Крюково", "Ильинская", "Ипподром", "Косино",
                "Красково", "Кратово", "Левобережная", "Лихоборы", "Люберцы", "Малаховка",
                "Митьково", "Молжаниново", "Моссельмаш", "Новоподрезково", "Останкино",
                "Отдых", "Панки", "Перово", "Петровско-Разумовская", "Плющево", "Подрезково",
                "Раменское", "Сортировочная", "Сходня", "Томилино", "Удельная", "Ухтомская",
                "Фабричная", "Фирсановская", "Химки", "Ховрино", "Электрозаводская"
        });

        mcdLines.put("МЦД-4 «Калужско-Нижегородский диаметр»", new String[]{
                "Аминьевская", "Апрелевка", "Белорусская", "Внуково", "Железнодорожная",
                "Кокошкино", "Крёкшино", "Курская", "Кусково", "Кутузовская", "Кучино",
                "Лесной Городок", "Марьина Роща", "Матвеевская", "Мещерская", "Минская",
                "Мичуринец", "Москва-Сити", "Нижегородская", "Никольское", "Новогиреево",
                "Новопеределкино", "Ольгино", "Очаково", "Переделкино", "Площадь трёх вокзалов",
                "Победа", "Поклонная", "Реутов", "Савеловская", "Салтыковская", "Санино",
                "Серп и Молот", "Солнечная", "Толстопальцево", "Чухлинка"
        });

        return mcdLines;
    }
}

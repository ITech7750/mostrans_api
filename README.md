
# Mostrans API

**Mostrans API** — это система для прогнозирования нагрузки на дорожную инфраструктуру и метро в зависимости от поэтажной площади застройки и времени суток. Основная цель проекта — предоставить API для анализа и предсказания транспортной загруженности, используя данные по застройкам и временным параметрам.

## Содержание

- [Функциональность](#функциональность)
- [Алгоритм предсказания нагрузки](#алгоритм-предсказания-нагрузки)
- [Требования](#требования)
- [Установка](#установка)
- [Примеры использования](#примеры-использования)
- [Авторство](#авторство)
- [Документация](#документация)

## Функциональность

Проект состоит из следующих компонентов:

1. **PostgreSQL Master и Replica** — основная база данных и её реплика для обеспечения отказоустойчивости и масштабируемости.
2. **Eureka Server** — сервис регистрации микросервисов для их автоматического обнаружения.
3. **Auth Service** — сервис аутентификации, работающий в двух экземплярах для обеспечения отказоустойчивости.
4. **Predict Service** — сервис прогнозирования транспортной нагрузки.
5. **Telegram Service** — сервис для взаимодействия через Telegram.
6. **Gateway** — API-шлюз, который маршрутизирует запросы к различным сервисам.
7. **Load Balancer** — балансировщик нагрузки для распределения запросов между экземплярами Auth Service.

Основная задача — предоставить интерфейс для получения прогноза загруженности транспортной системы на основе входных данных о площади застройки и времени.

## Алгоритм предсказания нагрузки

Predict Service использует алгоритм, основанный на поиске в ширину (BFS), для предсказания транспортной нагрузки. Этот алгоритм разработан для моделирования пассажиропотока в метро с учётом закономерностей движения пассажиров в час пик.

Шаги алгоритма:

1. Инициализация:
* Алгоритм начинается с начального распределения пассажирской нагрузки, основанного на исторических данных и площадях зданий.
* Каждой станции в метро присваивается начальное количество пассажиров.

2. Обход в ширину (BFS):
* Обход в ширину запускается от начальной станции, имитируя движение пассажиров.
* Обход следует по соединениям в метро.

3. Распределение пассажиропотока:
* По мере того, как BFS проходит по сети, к каждой станции добавляется дополнительная пассажирская нагрузка: количество пассажиров, вышедших на этой станции.
* Эта дополнительная пассажирская нагрузка распределяется по следующему правилу: 
* Если текущая станция находится за пределами кольцевой линии (коричневая), то к центру движется примерно 80% дополнительной пассажирской нагрузки. Остальные 20% распределяются пропорционально другим станциям, соединённым с текущей станцией.
* Иначе пассажиропоток распределяется по всем смежным станциям равномерно.

## Требования

Перед запуском убедитесь, что у вас установлены:

- **Docker** и **Docker Compose** для запуска сервисов в контейнерах.
- **Java 17** для совместимости с Kotlin и Spring Boot.
- **Gradle** для сборки проекта.

## Установка

Для установки и запуска проекта выполните следующие шаги:

1. **Клонируйте репозиторий**:

   ```bash
   git clone https://github.com/ITech7750/mostrans_api.git
   ```

2. **Перейдите в директорию проекта**:

   ```bash
   cd mostrans_api
   ```

3. **Соберите проект с помощью Gradle**:

   ```bash
   ./gradlew build
   ```

4. **Запустите проект с помощью Docker Compose**:

   ```bash
   docker-compose up --build
   ```

Это создаст и запустит все необходимые контейнеры:

- `postgres-db-master`: основная база данных.
- `postgres-db-replica`: реплика базы данных.
- `eureka-server`: сервер регистрации.
- `auth-service-1` и `auth-service-2`: два экземпляра сервиса аутентификации.
- `predict-service`: сервис прогнозирования нагрузки.
- `telegram-service`: сервис для взаимодействия через Telegram.
- `gateway`: шлюз для API.
- `load-balancer`: балансировщик нагрузки.

## Примеры использования

Пример запроса к Predict Service для получения прогноза транспортной нагрузки:

```bash
curl -X POST http://localhost:8003/predict \
  -H "Content-Type: application/json" \
  -d '{"floor_area": 5000, "time": "2024-10-01T08:00:00"}'
```

Где:
- `floor_area` — площадь застройки в квадратных метрах.
- `time` — время для прогнозирования нагрузки.

## Авторство

Разработано [iTehn7750@gmail.com](mailto:iTehn7750@gmail.com).

## Документация

Проект использует **OpenAPI (Swagger)** для автоматической генерации документации по API. Документация доступна по адресу:

```
http://localhost:8080/swagger-ui.html
```
